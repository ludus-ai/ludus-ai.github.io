<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" charset="utf-8">
    <title>Welcome to Ludus AI</title>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;500&display=swap');
    </style>
    <script src="https://code.jquery.com/jquery-3.6.4.js"
        integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E=" crossorigin="anonymous"></script>

    <style>
        :root {
            --color-background: #36393F;
            --color-text: #FFF;
            --color-primary: #7289DA;
            --color-primary-dark: #677BC4;
            --color-secondary: #B9BBBE;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: Poppins, sans-serif;
            background-color: #36393F;
            color: #FFF;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
        }


        .btn {
            background-color: #7289DA;
            color: #FFF;
            font-size: 1rem;
            padding: 1rem 2rem;
            border: none;
            border-radius: 5px;
            text-align: center;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s ease;

            margin-bottom: 25px;
        }

        .btn:hover {
            background-color: #677BC4;
        }

        .titleCard {
            position: sticky;
            width: 100%;
            text-align: center;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        p {
            font-family: Poppins, sans-serif;
            font-weight: lighter;
        }

        .studentCard {
            background-color: #36393f;
            width: 70vw;
            padding: 20px;
            margin-top: 5vh;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.3);
        }

        .studentCard p {
            font-family: Poppins, sans-serif;
            font-weight: 100;
        }

        .scHeader {
            display: flex;
        }

        .scHeader h2 {
            justify-content: center;
        }

        .studentDetail {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        .studentDetail h4 {
            font-weight: normal;
        }

        .studentDetail input {
            padding: 10px;
            font-size: 16px;
            border-radius: 8px;
            background-color: #40444b;
            color: #fff;
            border: solid 1px #fff;
            outline: none;
            text-align: center;
            width: fit-content;
            font-family: Poppins, sans-serif;
            font-weight: 100;

            width: 10vw;
        }

        .scsdInput {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .scBodyUpdateRow {
            display: flex;
            justify-content: right;
            margin-top: 3vh;
        }

        .scBodyUpdateRow button {
            background-color: #7289DA;
            color: #FFF;
            font-size: 0.9rem;
            padding: 0.7rem;
            border: none;
            border-radius: 5px;
            text-align: center;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s ease;

            margin-bottom: 25px;
        }

        button:hover {
            background-color: #677BC4;
        }

        button {
            background-color: #7289DA;
            color: #FFF;
            font-size: 0.9rem;
            padding: 0.7rem;
            border: none;
            border-radius: 5px;
            text-align: center;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s ease;
        }

        button.danger {
            background-color: rgba(255, 0, 0, 0.664);
        }

        button.danger:hover {
            background-color: rgb(255, 0, 0);
        }

        button.pending {
            background-color: rgb(245, 245, 35);
            color: black;
        }

        button.pending:hover {
            background-color: rgba(255, 255, 0, 0.5);
        }

        .popup {
            position: sticky;
            left: 50%;
            top: 50%;
            -webkit-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
            background-color: #36393f;
            padding: 1vw;
            border: solid 1px;
        }

        .invisible {
            visibility: hidden;
        }

        .nav-popup-container {
            position: absolute;
            display: flex;
            justify-content: center;
            flex-direction: row;
            width: 90%;
            height: 90%;
        }

        hr {
            margin: 0;
        }

        .nav-popup-container-2 {
            display: flex;
            justify-content: center;
            flex-direction: column;
        }

        .nav-popup {
            background-color: #2f3136;
            text-align: center;
            width: 90vw;
            height: fit-content;
            max-width: 800px;
            border: solid 1px #fff;
        }

        .nav-popup h2 {
            font-family: Poppins, sans-serif;
            font-weight: 100;
            font-size: 2rem;
        }


        .nav-options {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .nav-option {
            height: 5vh;
            font-family: Poppins, sans-serif;
            font-size: 1.3rem;
            background-color: #2f3136;
            border: solid 1px #40444b;
            border-radius: 5px;
            transition: all 0.4s;
            cursor: pointer;
            min-height: 50px;
        }

        .nav-option:hover {
            background-color: #36393f;
            border-color: #7289da
        }

        .vflexbox {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .hflexbox {
            display: flex;
            flex-direction: row;
            justify-content: center;
        }

        .menu-icon {
            position: absolute;
            top: 0px;
            left: 0px;
            cursor: pointer;
        }

        .menu-icon img {
            width: 40px;
        }

        .scBodyReport {
            margin-top: 3vh;
        }

        .studentReport {
            background-color: #2f3136;
            padding: 10px;
            word-wrap: normal;
        }

        .tempRow {
            display: flex;
            justify-content: space-evenly;
            margin: 2vh 0;
        }
    </style>
</head>

<body>
    <div class="popup invisible" id="deleteAccountPopupCard">
        <h1>Delete my account</h1>
        <h4>Your details will be removed from your computer. Your AI profile will be deleted. This is permanent.
            Continue?</h4>
        <div class="deleteAccountBtnRow">
            <button class="danger" onclick="deleteAccount()">Yes, delete</button>
            <button onclick="$('#deleteAccountPopupCard')[0].classList.add('invisible')">No, I changed my mind</button>
        </div>
    </div>
    <div class="container">
        <a class="menu-icon" onclick="nav.toggle()"><img
                src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/Hamburger_icon.svg/1024px-Hamburger_icon.svg.png"></a>
        <div class="titleCard">

            <h1>Student Dashboard</h1>
            <hr>
        </div>
        <div class="studentCard">
            <div class="scHeader">
                <h2>Hello, ##account.name##.</h2>
            </div>
            <div class="scBody">
                <div class="scBodyHeader">
                    <p>Please remember that this is pre-production, so UI/UX may change later.</p>
                    <p>Welcome to your Dashboard. Here, you can view and customise all your data, and change your
                        preferences as you like.</p>
                </div>
                <div class="scBodyStudentDetails">
                    <div class="studentDetail">
                        <h4>Your name</h4>
                        <div class="scsdInput"><input type="text" value="##account.name##" class="inputText"></input>
                        </div>
                    </div>
                    <div class="studentDetail">
                        <h4>Your syllabus (CBSE, ICSE, STATE)</h4>
                        <div class="scsdInput"></div>
                    </div>
                    <div class="studentDetail">
                        <h4>Your special interests</h4>
                        <div class="scsdInput"><input type="text" value="##account.special_interests##"
                                class="inputText"></input></div>
                    </div>
                    <div class="studentDetail">
                        <h4 style="font-weight: lighter">You are using our <b>Socrates</b> model.</h4>
                        <div class="scsdInput"><button style="background-color: #333">Other AI models may come
                                soon.</button></div>
                    </div>

                </div>
                <div class="scBodyUpdateRow">
                    <button id="updateDataBtn" onclick="updateData()">Update</button>
                </div>
                <hr>
                <div class="scBodyTempSetting">
                    <h2>Creativity and Predictability</h2>
                    <p>The AI can be really creative (while also being a little unpredictable) in its answers, or it can be more precise and also more repetitive.
                        Here, you can change this setting.
                    </p>
                    <div class="tempRow">
                        <button onclick="setAccountTemperature(0.2)">Predictable</button>
                        <button onclick="setAccountTemperature(0.5)">Balanced</button>
                        <button onclick="setAccountTemperature(0.8)">Creative</button>
                    </div>
                    <p>Your AI will be ##account.temperatureFriendlyDescription##.</p>
                </div>
                <hr>
                <div class="scBodyReport">
                    <h2>Student Report</h2>
                    <p>This is your student report generated by your teacher. It's an outline of your strengths and weaknesses, and also how you can improve.
                        This is not a compehensive academic review, and since it's generated by AI, it may occasionally be incorrect.
                    </p>
                    <div class="studentReport">##account.report##</div>
                </div>
                <div class="scFooter">
                    <h4>Since this is a prototype, accounts are temporary, and all details are stored on your computer.
                        You may choose
                        to delete all data stored and create a new account.
                    </h4>
                    <button class="danger" onclick="deleteAccountPopup()">Delete my account</button>
                </div>
            </div>
        </div>
        <div class="nav-popup-container invisible">
            <div class="nav-popup-container-2">
                <div class="nav-popup">
                    <div class="nav-header">
                        <nav class="hflexbox">
                            <h2>Navigation</h2>
                        </nav>
                        <hr>
                        <div class="nav-options vflexbox">
                            <a onclick="nav.goto('main')" class="vflexbox nav-option">Home</a>
                            <a onclick="nav.close()" class="nav-option vflexbox">Dashboard</a>
                            <a onclick="nav.goto('how_it_works')" class="nav-option vflexbox">How it Works (Help)</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const studentCard = document.getElementsByClassName("studentCard")[0];
        const deleteAccountPopupCard = document.getElementById("deleteAccountPopupCard");

        const ludusAccount = JSON.parse(localStorage.getItem("ludusAccount"));

        function templateEngine(text, context) {
            // ##<text>## represents something to replacee
            // @ represents accessing some object within the context.

            return text.replace(/##(.*?)##/g, (_, key) => {
                const keys = key.split('.');
                let value = context;

                for (let i = 0; i < keys.length; i++) {
                    value = value[keys[i]];

                    if (value === undefined) {
                        return '';
                    }
                }

                return value;
            });
        }

        function renderHTML() {
            console.log("Rendering HTML with ");
            console.log(ludusAccount);
            $('.container')[0].innerHTML = templateEngine(document.getElementsByTagName("body")[0]
                .innerHTML, {
                    account: ludusAccount
                });
        }

        renderHTML();

        if (!ludusAccount) {
            alert("Seems like your account was deleted. Redirecting to creation page...");
            setTimeout(() => window.location = 'create_account.html', 2000);
        }

        function hideElement(elem) {
            elem.classList.add('invisible')
        }

        function showElement(elem) {
            elem.classList.remove('invisible')
        }

        function deleteAccountPopup() {
            hideElement(studentCard);
            showElement(deleteAccountPopupCard);
        }

        function deleteAccount() {
            localStorage.clear();
            $('.popup button').each((i, element) => {
                element.classList.add('invisible')
            });
            $('.popup h4')[0].innerText = "Successfully deleted account. Redirecting...";

            setTimeout(() => nav.goto("index"), 1000)
        }

        function getDaySegment() {
            const date = new Date();
            const hour = date.getHours();

            if (hour < 12) {
                return 'morning';
            } else if (hour < 6) {
                return 'afternoon';
            } else if (hour < 24) {
                return 'evening'
            }
        }

        function updateData() {
            console.log("Updating data to ")
            let inputs = $(".scsdInput input");

            ludusAccount.name = inputs[0].value;
            ludusAccount.special_interests = inputs[1].value;

            console.log(ludusAccount);

            localStorage.setItem("ludusAccount", JSON.stringify(ludusAccount));

            $("#updateDataBtn")[0].classList.remove("pending");
            location.reload();
        }

        function setAccountTemperature(temp) {
            ludusAccount.temperature = temp;

            if (temp == 0.2) {
                ludusAccount.temperatureFriendlyDescription = "a little more predictable, and also a bit more precise";
            } else if (temp == 0.5) {
                ludusAccount.temperatureFriendlyDescription = "balanced in its answers";
            } else if (temp == 0.8) {
                ludusAccount.temperatureFriendlyDescription = "creative and less predictable, but may be a little less precise.";
            }

            localStorage.setItem("ludusAccount", JSON.stringify(ludusAccount));
            location.reload();
        }
        let inputs = $(".scsdInput input");
        let inputMap = ['name', 'special_interests'];

        for (let i = 0; i < inputs.length; i++) {
            let input = inputs[i];
            console.log("Updating...")
            input.addEventListener('keydown', (e) => {
                setTimeout(() => {
                    console.log("Event listener")
                    if (input.value != ludusAccount[inputMap[i]]) {
                        console.log($('#updateDataBtn')[0].classList);
                        console.log(input.value);
                        console.log(ludusAccount[inputMap[i]]);
                        if (!$("#updateDataBtn")[0].classList.contains('pending')) $("#updateDataBtn")[
                            0].classList.add('pending')
                    } else {
                        $("#updateDataBtn")[0].classList.remove('pending')
                    }
                }, 500);
            });

            console.log("Added input listeneer")
        }
    </script>
    <script src="navigator.js"></script>
</body>

</html>